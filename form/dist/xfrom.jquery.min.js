function xAutoComplete(e){this.opts=e||{},this.eles={$selector:null,$ul:null}}function _getValue(e,t){return"string"==typeof e?e:t?e[t]||e:e}function xCombo(e){this.opts={},this.eles={},this.selectedItems=[],this.isFirstTime=!0}function xPupSelect(e){this.opts={},e&&(this.opts=e)}function xSelect(e){this.opts=e||{},this.eles={$selector:null,$ul:null}}xAutoComplete.prototype.render=function(e){var t=this;this.opts=e;var o=e.selector;e.tField||"text",e.vField||"value",e.vField||"parent",e.subNode,e.value||"",e.isMultiSelect||"N",e.data,e.onFilter,e.onSelect,e.onShow,e.onHide,e.onLoadData;this.eles.$ul=jQuery("<ul></ul"),o.append(this.eles.$ul),this.eles.$text=jQuery(">input",o),this.eles.$selector=o,this.eles.$hValue=jQuery('<input type="hidden" />');var s=this.eles.$text.attr("name");s&&(this.eles.$hValue.attr("name",s),this.eles.$text.attr("name",s+"Desc")),this.eles.$hValue.val(this.opts.value),o.append(this.eles.$hValue),this.eles.$selector.on("click",function(e){var o=t.eles.$ul.is(":visible");o?t.hide():t.show(),""==t.getText()?t.loadData(""):t.renderItems(t.opts.data,function(e){return _getValue(e,t.opts.tField).indexOf(t.getText())>-1}),e.stopPropagation()}),this.eles.$text.keyup(function(e){var o=jQuery(this).val();t.eles.$ul.show(),t.loadData(o)}),this.eles.$ul.hover(function(){},function(){t.hide()})},xAutoComplete.prototype.clearLi=function(){this.eles.$ul.empty()},xAutoComplete.prototype.hide=function(){this.onHide(),this.eles.$ul.hide()},xAutoComplete.prototype.show=function(){this.onShow(),this.eles.$ul.show()},xAutoComplete.prototype.onShow=function(){var onShow=this.opts.onShow;"function"==typeof this.opts.onShow?this.opts.onShow.call(this,me.getValue(),me.getText()):onShow&&eval(onShow+".call(this,this.getValue(),this.getText())")},xAutoComplete.prototype.onSelect=function(){var onSelect=this.opts.onSelect;"function"==typeof this.opts.onSelect?this.opts.onSelect.call(this,me.getValue(),me.getText()):onSelect&&eval(onSelect+".call(this,this.getValue(),this.getText())")},xAutoComplete.prototype.onHide=function(){var onHide=this.opts.onHide;"function"==typeof this.opts.onHide?this.opts.onHide.call(this,me.getValue(),me.getText()):onHide&&eval(onHide+".call(this,this.getValue(),this.getText())")},xAutoComplete.prototype.getValue=function(){return this.eles.$hValue.val()},xAutoComplete.prototype.getText=function(){return this.eles.$text.val()},xAutoComplete.prototype.setValue=function(e,t){var o=this;if(void 0!=e&&this.eles.$hValue.val(e),void 0!=t)this.eles.$text.val(t);else{if(!(this.opts&&this.opts.data&&this.opts.data.length>0))return;for(var s=0;s<this.opts.data.length;s++){var l=this.opts.data[s],t=_getValue(l,o.opts.tField);return void this.eles.$text.val(t)}}},xAutoComplete.prototype.renderItems=function(e,t){var o=this;if(this.eles.$ul.empty(),this.opts&&this.opts.data&&this.opts.data.length>0)for(var s=0;s<this.opts.data.length;s++){var l=this.opts.data[s];t&&0==t(l)||!function(e){var t=o.renderItem(e);o.eles.$ul.append(t)}(l)}},xAutoComplete.prototype.renderItem=function(item){var me=this,$content,renderItem=this.opts.renderItem;if("function"==typeof this.opts.renderItem)$content=this.opts.renderItem.call(this,item);else if(renderItem)eval("$content= "+renderItem+".call(this,item)");else{$content=jQuery("<div></div>");var text=_getValue(item,this.opts.tField),value=_getValue(item,this.opts.vField);$content.html(text),$content.attr("value",value)}var $li=jQuery("<li></li>");return $li.click(function(e){me.setValue(value,text),me.hide(),e.stopPropagation()}),"string"==typeof $content?$li.html($content):$li.append($content)},xAutoComplete.prototype.onItemClick=function(e){_getValue(e,this.opts.tField),_getValue(e,this.opts.vField)},xAutoComplete.prototype.loadData=function(){var me=this;me.clearLi(),this.eles.$ul.append("<li>loadding...</li>");var loadData=this.opts.loadData;"function"==typeof this.opts.loadData?this.opts.loadData.call(this,me.getText()):loadData?eval(" "+loadData+".call(this,this.getText())"):this.renderItems(this.opts.data,function(e){return _getValue(e,me.opts.tField).indexOf(me.getText())>-1})},xAutoComplete.prototype.refresh=function(e){this.opts.data=e,this.renderItems(e)};var autocomplete=function(window){var controls=[],members={getAutocomple:function(e){for(var t=0;t<selects.length;t++){var o=selects[t];if(o.opts.selector.attr("id")&&e.attr("id")&&o.opts.selector.attr("id")==e.attr("id"))return o}return null},render:function(selector,opts){selector||(selector=".autocomplete"),opts||(opts={});var me=this;jQuery(selector).each(function(item){var $selector=jQuery(this),newOpts={};for(var item in opts)newOpts.item=opts[item];newOpts.tField=$selector.attr("tField"),newOpts.vField=$selector.attr("vField"),newOpts.onShow=$selector.attr("onShow"),newOpts.onHide=$selector.attr("onHide"),newOpts.onSelect=$selector.attr("onSelect"),newOpts.loadData=$selector.attr("loadData"),newOpts.renderItem=$selector.attr("renderItem");var _data={};eval("(_data={data:"+($selector.attr("data")||"[]")+"})"),newOpts.data=_data.data,newOpts.selector=$selector;var xautocomplete=new xAutoComplete(newOpts);controls.push(xautocomplete),xautocomplete.render(newOpts)})}};return members}(window);xCombo.prototype.render=function(opts){var me=this;this.opts=opts;var $selector=opts.selector,tField=opts.tField||"text",vField=opts.vField||"value",pField=opts.vField||"parent",subNode=opts.subNode,value=opts.value||"",isMultiSelect=opts.isMultiSelect||"N",data=opts.data,onFilter=opts.onFilter,onSelect=opts.onSelect,onShow=opts.onShow,onHide=opts.onHide,onLoadData=opts.onLoadData;this.eles.$ul=jQuery("<ul></ul"),$selector.append(this.eles.$ul),this.eles.$text=jQuery(">input",$selector),this.eles.$selector=$selector,this.eles.$hValue=jQuery('<input type="hidden" />');var name=this.eles.$text.attr("name");name&&(this.eles.$hValue.attr("name",name),this.eles.$text.attr("name",name+"Desc")),this.eles.$hValue.val(this.opts.value),$selector.append(this.eles.$hValue),this.eles.$selector.on("click",function(e){var t=me.eles.$ul.is(":visible");t?me.hide():me.show(),e.stopPropagation()}),this.eles.$text.keyup(function(e){var t=jQuery(this).val();me.selectedItems=[],me.clearValue(),me.renderItems(me.opts.data,function(e,o){return me.getParentFilterExpress(e)&&o.indexOf(t)>-1})}),this.eles.$ul.hover(function(){},function(){me.hide()}),this.opts.onLoadData?(this.eles.$ul.append("<li>数据加载中...</li>"),eval(this.opts.onLoadData+".call(this)")):(this.setValue(value),this.renderItems(opts.data))},xCombo.prototype.onFilter=function(e){return!0},xCombo.prototype.isMultiSelect=function(){return"Y"==this.opts.isMultiSelect},xCombo.prototype.getData=function(){return[]},xCombo.prototype.refresh=function(e){this.opts.data=e,this.eles.$ul.append("<li>数据加载中...</li>"),this.setValue(this.getValue()),this.renderItems(e)},xCombo.prototype.renderItems=function(e,t){if(e&&0!=e.length){var o=this;this.eles.$ul.empty();for(var s=0;s<e.length;s++){var l=e[s];!function(e){var s,l,i;if("string"==typeof e?s=l=e:(s=e[o.opts.tField],l=e[o.opts.vField],i=e[o.opts.pField]),!t||0!=t(e,s)){var r=jQuery("<li></li>");o.opts.renderItem&&r.append(o.opts.renderItem(e,s)),o.isMultiSelect()&&r.addClass("item"),r.html(s),r.attr("value",l),r.attr(o.opts.pField,i),r.click(function(t){if(l!=o.getValue()){if("Y"==o.opts.isMultiSelect){var i=r.hasClass("active");i?(o.removeItem(e),r.removeClass("active")):(o.addItem(e),r.addClass("active"))}else o.hide(),o.selectedItems=[],r.siblings().removeClass("active"),r.addClass("active"),o.setValue(l,s);t.stopPropagation()}}),jQuery.inArray(e,o.selectedItems)>-1&&r.addClass("active"),o.eles.$ul.append(r)}}(l)}}},xCombo.prototype.show=function(){this.FilterForParent(),this.eles.$ul.show()},xCombo.prototype.hide=function(){this.eles.$selector.attr("isValid",this.selectedItems.length>0?"Y":"N"),this.eles.$ul.hide()},xCombo.prototype.getValue=function(){return this.eles.$hValue.val()},xCombo.prototype.addItem=function(e){this.selectedItems.push(e),this.renderValue()},xCombo.prototype.removeItem=function(e){for(var t=0;t<this.selectedItems.length;t++){var o=this.selectedItems[t];o==e&&this.selectedItems.splice(t,1)}this.renderValue()},xCombo.prototype.selectedItems=[],xCombo.prototype.setValue=function(e,t){var o=this;if(t&&this.eles.$text.val(t),this.opts&&this.opts.data)for(var s=0;s<this.opts.data.length;s++){var l,i=this.opts.data[s];l="string"==typeof i?i:i[o.opts.vField],l&&e.toString().indexOf(l.toString())>-1&&this.selectedItems.push(i)}this.renderValue()},xCombo.prototype.clearValue=function(){this.eles.$hValue.val(""),this.setSubCombo()},xCombo.prototype.renderValue=function(){for(var e=this,t=[],o=[],s=0;s<this.selectedItems.length;s++){var l,i,r=this.selectedItems[s];"string"==typeof r?i=l=r:(i=r[e.opts.tField],l=r[e.opts.vField]),t.push(i),o.push(l)}this.eles.$text.val(t.join(",")),this.eles.$hValue.val(o.join(",")),this.opts.onSelect&&this.opts.onSelect.call(this),this.setSubCombo()},xCombo.prototype.getParentFilterExpress=function(e){if($parentNode=jQuery(".combo[id="+this.eles.$selector.attr("pId")+"]"),$parentNode&&$parentNode.length>0){var t=combo.getCombo($parentNode);if(t){var o=t.getValue(),s=this.opts.pField;return o.toString().indexOf(e[s])>-1}}return!0},xCombo.prototype.FilterForParent=function(){var e=this;this.renderItems(this.opts.data,function(t){return e.getParentFilterExpress(t)})},xCombo.prototype.isFirstTime=!0,xCombo.prototype.setSubCombo=function(){if(this.isFirstTime)return void(this.isFirstTime=!1);var e=this;if($subNode=jQuery(".combo[pId="+this.eles.$selector.attr("id")+"]"),$subNode&&$subNode.length>0){var t=combo.getCombo($subNode);if(t){var o=(this.getValue(),$subNode.attr("pField"));t.renderItems(t.opts.data,function(t){return t[o]==e.getValue()}),t.selectedItems=[],t.setValue("")}}};var combo=function(){var combos=[],members={getCombo:function(e){for(var t=0;t<combos.length;t++){var o=combos[t];if(o.opts.selector.attr("id")&&e.attr("id")&&o.opts.selector.attr("id")==e.attr("id"))return o}return null},render:function(selector){selector||($selectors=jQuery(".combo"));for(var me=this,i=0;i<$selectors.length;i++)!function(i){var seletor=$selectors[i],$seletor=jQuery(seletor),opts={};opts.selector=$seletor,opts.tField=$seletor.attr("tField");var _data={};eval("(_data={data:"+($seletor.attr("data")||"[]")+"})"),opts.data=_data.data,opts.vField=$seletor.attr("vField"),opts.onLoadData=$seletor.attr("onLoadData"),opts.pField=$seletor.attr("pField"),opts.subNode=$seletor.attr("subNode"),opts.value=$seletor.attr("value")||jQuery(">input:first",$seletor).val(),opts.isMultiSelect=$seletor.attr("isMultiSelect");var xcombox=new xCombo;opts.onSelect=function(){var me=this,onSelect=this.eles.$selector.attr("onSelect");onSelect&&eval(onSelect+".call($seletor,me.getValue(),me.getText())")},combos.push(xcombox),xcombox.render(opts)}(i)},getValue:function(e){},setValue:function(e){}};return members}(),xForm=function(e){var t={select:function(){return"undefined"!=typeof select?select:{render:function(){}}},combo:function(){return"undefined"!=typeof combo?combo:{render:function(){}}},autocomplete:function(){return"undefined"!=typeof autocomplete?autocomplete:{render:function(){}}},render:function(){this.select().render(),this.combo().render(),this.autocomplete().render()}};return t}(window);jQuery(function(){xForm.render()}),xPupSelect.prototype.render=function(e){e.tField,e.vField},xPupSelect.prototype.getValue=function(){},xPupSelect.prototype.setValue=function(e){},xPupSelect.prototype.renderItem=function(e){},xPupSelect.prototype.onItemClick=function(){},xPupSelect.prototype.loadData=function(){},xPupSelect.prototype.refresh=function(e){},xSelect.prototype.hide=function(){this.onHide(),this.eles.$ul.hide()},xSelect.prototype.show=function(){this.parentFilter(),this.onShow(),this.eles.$ul.show()},xSelect.prototype.render=function(e){var t=this,o=e.selector;e.onShow||function(){},e.onHide||function(){};this.opts=e;var s=o,l=jQuery(">ul",s);this.eles.$ul=l,this.eles.$selector=s;var i=jQuery(">li",l),r=jQuery(">input",s),n=s.attr("rendered");if("Y"!=n){this.eles.$text=r;var a=jQuery('<input type="hidden" />');this.eles.$hValue=a;var u=r.attr("name");u&&(a.attr("name",u),r.attr("name",u+"Desc")),s.append(a),l.css("top",s.height()+2+"px");var p=r.val()||s.attr("value");if(s.attr("rendered","Y"),void 0==p||""==p){var c=jQuery(">li[isSelected=Y]",l);if(c.size()>0){var h=0==c.attr("value")?c.text():c.attr("value");c.attr("value")!=h&&c.attr("value",h),p=h}}t.setValue(p,!0),s.on("click",function(e){var o=l.is(":visible");o?t.hide():t.show(),e.stopPropagation()}),i.on("click",function(e){var o=0==jQuery(this).attr("value")?jQuery(this).text():jQuery(this).attr("value"),s=t.getValue();s!=o&&(jQuery(this).attr("value")!=o&&jQuery(this).attr("value",o),t.setValue(o),t.hide(),e.stopPropagation())})}},xSelect.prototype.refresh=function(){},xSelect.prototype.filter=function(){},xSelect.prototype.setSubValue=function(){this.opts.subSelect&&this.opts.subSelect.setValue("")},xSelect.prototype.parentFilter=function(){if(this.opts.parentSelect){var e=this.opts.parentSelect.getValue();jQuery(">li",this.eles.$ul).hide(),jQuery(">li["+this.opts.pField+"="+e+"]",this.eles.$ul).show()}},xSelect.prototype.getValue=function(){return this.eles.$hValue.val()},xSelect.prototype.getText=function(){return this.eles.$text.val()},xSelect.prototype.onShow=function(){var onShow=this.opts.onShow;onShow&&eval(onShow+".call(this)")},xSelect.prototype.onHide=function(){var onHide=this.opts.onHide;onHide&&eval(onHide+".call(this)")},xSelect.prototype.setValue=function(e){var t=this.eles.$selector,o=jQuery(">ul",t),s=(jQuery(">li",o),jQuery(">input:first",t)),l=jQuery(">input[type=hidden]",t),i=jQuery(">li[value="+e+"]",o).text();i?(s.val(i),l.val(e)):(s.val(e),l.val(e)),this.onSelect(),this.setSubValue()},xSelect.prototype.onSelect=function(){var onSelect=this.opts.onSelect;"function"==typeof this.opts.onSelect?this.opts.onSelect.call(this,me.getValue(),me.getText()):onSelect&&eval(onSelect+".call(this,this.getValue(),this.getText())")},xSelect.prototype.onItemClick=function(){};var select=function(e){var t=[],o={getSelect:function(e){for(var o=0;o<t.length;o++){var s=t[o];if(s.opts.selector.attr("id")&&e.attr("id")&&s.opts.selector.attr("id")==e.attr("id"))return s}return null},getSubSelect:function(e){return $subNode=jQuery(".select[pId="+e.attr("id")+"]"),this.getSelect($subNode)},getParentSelect:function(e){$parentNode=jQuery(".select[id="+e.attr("pId")+"]");var t=this.getSelect($parentNode);return t&&(t.opts.subSelect=this.getSelect(e)),t},render:function(e,o){e||(e=".select"),o||(o={});var s=this;jQuery(e).each(function(e){var l=jQuery(this),i={};for(var e in o)i.item=o[e];i.pField=l.attr("pField"),i.onShow=l.attr("onShow"),i.onHide=l.attr("onHide"),i.onSelect=l.attr("onSelect"),i.selector=l;var r=new xSelect(i);t.push(r),r.render(i),i.subSelect=s.getSubSelect(l),i.parentSelect=s.getParentSelect(l)})}};return o}(window);